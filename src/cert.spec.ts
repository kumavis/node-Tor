import test from 'ava';
import type { CellCerts } from './messaging';
import { CertTypes, validateCertsCellForIdentities } from './cert';

const b = (s: string) => Buffer.from(s, 'hex')

// from the arti source
const fixtureCerts = {
  [CertTypes.RSA_ID_X509]: b('308201B930820122A0030201020208607C28BE6C390943300D06092A864886F70D01010B0500301F311D301B06035504030C147777772E74636A76356B766A646472322E636F6D301E170D3230303831303030303030305A170D3231303831303030303030305A301F311D301B06035504030C147777772E74636A76356B766A646472322E636F6D30819F300D06092A864886F70D010101050003818D0030818902818100D38B1E6CEB946E0DB0751F4CBACE3DCB9688B6C25304227B4710C35AFB73627E50500F5913E158B621802612D1C75827003703338375237552EB3CD3C12F6AB3604E60C1A2D26BB1FBAD206FF023969A90909D6A65A5458A5312C26EBD3A3DAD30302D4515CDCD264146AC18E6FC60A04BD3EC327F04294D96BA5AA25B464C3F0203010001300D06092A864886F70D01010B0500038181003BCE561EA7F95CC00B78AAB5D69573FF301C282A751D4A651921D042F1BECDBA24D918A6D8A5E138DC07BBA0B335478AE37ABD2C93A93932442AE9084329E846170FE0FC4A50AAFC804F311CC3CA4F41D845A7BA5901CBBC3E021E9794AAC70CE1F37B0A951592DB1B64F2B4AFB81AE52DBD9B6FEDE96A5FB8125EB6251EE50A'),
  [CertTypes.IDENTITY_V_SIGNING]: b('01040006CC2A01F82294B866A31F01FC5D0DA8572850A9B929545C3266558D7D2316E3B74172B00100200400DCB604DB2034B00FD16986D4ADB9D16B21CB4E4457A33DEC0F538903683E96E9FF1A5203FA27F86EF7528D89A0845D2520166E340754FFEA2AAE0F612B7CE5DA094A0236CDAC45034B0B6842C18E7F6B51B93A3CF7E60663B8AD061C30A62602'),
  [CertTypes.SIGNING_V_TLS_CERT]: b('01050006C98A03B4FD606B64E4CBD466B8D76CB131069BAE6F3AA1878857C9F624E31D77A799B8007173E5F8068431D0D3F5EE16B4C9FFD59DF373E152A87281BAE744AA5FCF72171BF4B27C4E8FC1C6A9FC5CA11058BC49647063D7903CFD9F512F89099B27BC0C'),
  [CertTypes.RSA_ID_V_IDENTITY]: b('DCB604DB2034B00FD16986D4ADB9D16B21CB4E4457A33DEC0F538903683E96E90006DA3A805CF6006F9179066534DE6B45AD47A5C469063EE462762723396DC9F25452A0A52DA3F5087DD239F2A311F6B0D4DFEFF4ABD089DC3D0237A0ABAB19EB2045B91CDCAF04BE0A72D548A27BF2E77BD876ECFE5E1BE622350DA6BF31F6E306ED896488DD5B39409B23FC3EB7B2C9F7328EB18DA36D54D80575899EA6507CCBFCDF1F'),
  // PEER_ED: b('dcb604db2034b00fd16986d4adb9d16b21cb4e4457a33dec0f538903683e96e9'),
  // PEER_RSA: b('2f1fb49bb332a9eec617e41e911c33fb3890aef3'),
}
  
const fixturePeerCertDigest = b('b4fd606b64e4cbd466b8d76cb131069bae6f3aa1878857c9f624e31d77a799b8')

const fixtureCertCell = {
  certs: Object.entries(fixtureCerts).map(([certType, cert]) => ({
    type: parseInt(certType, 10),
    body: cert,
  })),
} as CellCerts;


test('validateCertsForEd25519Identity', t => {
  t.notThrows(() => {
    validateCertsCellForIdentities(fixtureCertCell, fixturePeerCertDigest, 0, 0);
  });
});